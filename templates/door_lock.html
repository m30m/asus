{% extends 'base.html' %}
{% block title %}Lamp Page{% endblock %}
{% block body %}
    {% raw %}
    <h1 class="ui center aligned header">Smart Door Lock Control Panel</h1>
    <div class="ui stackable two column vertically divided grid container">
        <div class="row">
            <div class="column">
                <div class="ui segment">State of The Lock</div>
            </div>
            <div class="column">
                <div class="ui segment">
                    <div class="ui toggle checkbox">
                        <input type="checkbox" id="checkbox" v-model="status" name="public">
                        <label>{{ getText() }}</label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" charset="utf-8">
    var app = new Vue({
      el: '.column',
      data: {
        status: true,
        socket: null
      },
      watch: {
        status: function () {
          if (this.socket) {
            this.socket.emit('update_state', { state: this.status })
          }
        }
      },
      methods: {
        getText: function () {
          if (this.status) return 'locked'
          return 'unlocked'
        }
      },
      created: function () {
        console.log('Starting connection to WebSocket Server')
        socket = io()
        this.socket = socket
        let vm = this
        socket.on('connect', function () {
          socket.emit('init', { type:'door', state: vm.status })
        })
        socket.on('act', data => {
          console.log(data)
          vm.status = data.state
        })
      }
    })
    </script>
    {% endraw %}
{% endblock %}